# https

## DuckDNS Addon
<small>https://www.home-assistant.io/addons/duckdns/</small>  

### Get a _DuckDNS_ account

1. Sign in to https://www.duckdns.org
1. Create your domain
1. Get your token
    1. Browse to _install_: https://www.duckdns.org/install.jsp
    1. Choose OS: _pi_
    1. Select your domain
    1. _Token_ is accessible in displayed command line
    ```
    echo url="https://www.duckdns.org/update?domains=<DOMAIN>&token=<TOKEN>&ip=" | curl -k -o ~/duckdns/duck.log -K -
    ```

### Complete the duckDNS Addon configuration
```yaml
{
  "lets_encrypt": {
    "accept_terms": true,
    "certfile": "fullchain.pem",
    "keyfile": "privkey.pem"
  },
  "token": "sdfj-2131023-dslfjsd-12321",
  "domains": ["<domain>.duckdns.org"],
  "seconds": 300
}
```

### Update HA configuration
`configuration.yaml`
````yaml
http:
  base_url: <domain>.duckdns.org:8123
  ssl_certificate: /ssl/fullchain.pem
  ssl_key: /ssl/privkey.pem
````

`/ssl` folder contains _pem_ files generated by _DuckDNS_ addon.

Now, HA can be accessed at `https://<domain>.duckdns.org:8123`.

## Enable _https_ `panel_iframe`s
_Grafana example_
```
grafana:
  title: Grafana
  url: https://domain/proxy/grafana
```

### NGINX

#### _hass.io_ plugins
<small>https://home-assistant.io/addons/nginx_proxy/</small>  

Install NGINX plugins in hass.io.
````yaml
{
  "domain": "<domain>.duckdns.org",
  "certfile": "fullchain.pem",
  "keyfile": "privkey.pem",
  "hsts": "max-age=31536000; includeSubDomains",
  "customize": {
    "active": true,
    "default": "nginx_proxy_default*.conf",
    "servers": "nginx_proxy/*.conf"
  }
}
````

#### Additional configuration file 
`nginx_proxy_default_grafana.conf` on host machine.
```
location /proxy/grafana/ {
    proxy_pass https://homeassistant:3000/;
    proxy_set_header Host $host;
    proxy_http_version 1.1;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection $connection_upgrade;
}
```

### Grafana
Update the Grafana hass.io plugins.
```yaml
{
  "log_level": "info",
  "ssl": true,
  "certfile": "fullchain.pem",
  "keyfile": "privkey.pem",
  "plugins": [],
  "env_vars": [
    {
      "name": "GF_SERVER_ROOT_URL",
      "value": "https://<domain>/proxy/grafana"
    }
  ]
}
```